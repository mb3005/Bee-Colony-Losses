---
title: "Bee_Colony_Losses"
output: html_document
---

--------------------------------------------------------------------------------------------------------------------------
```{r  Loading Packages }
library(tidyverse)
library(lubridate)

```


```{r  Reading CSV files}
honey <- read_csv("Honey.csv")
honey

colony <- read_csv("Colony.csv")
colony

stressors <- read_csv("Stressors.csv")
stressors

summary(honey)

# not required to convert year numbers to date format as there is no month/day information 

sum(is.na(honey)) # no missing values in this data set 
```


```{r  Colony df: Removing rows with mostly NA values }
# 2019-Q2 seems to be missing a lot of information 
colony$`Starting Colonies` <- as.numeric(colony$`Starting Colonies`)
colony[is.na(colony$`Starting Colonies`), ]

# let's take a look at all other values in 2019-Q2 

colony %>% 
  filter(Year == "2019-Q2")

# looks like there is no information for this quarter; it would be helpful to remove these rows along with any other
# rows that have missing values in all of these numeric columns 

colony <- colony %>% 
  filter_at(vars(`Starting Colonies`, `Maximum Colonies`, `Lost Colonies`, `Percent Loss`, `Added Colonies`, `Renovated Colonies`, `Percent Renovated`), all_vars(!is.na(.)))

colony

```

```{r  Colony df: Imputing missing values, and converting character to numeric } 
# some number columns classified as character; converting chr to numeric (Starting Colonies, Maximum Colonies, Lost Colonies, Percent Loss, Added Colonies, Renovated Colonies, Percent Renovated, Year)

colony

summary(colony)
colony <- colony %>% 
  mutate_at(c(2:8), as.numeric)

sapply(colony, class)

# many NAs are now apparent in percent_renovated column because they were previously denoted as (Z) for being 0/close
# to zero. We can fill in those NA values with their calculations 

colony <- colony %>% 
  mutate(`Percent Renovated` = case_when(
    !is.na(`Percent Renovated`) ~ `Percent Renovated`, 
    is.na(`Percent Renovated`) ~ (round(`Renovated Colonies`*100/`Maximum Colonies`))
  ))

colony

sapply(colony, class)

# are there any other NA values in the data frame? 
colony[rowSums(is.na(colony)) > 0, ]

# there are some missing values in 'Percent Loss' for some states, which can be computed 
# Percent loss = number of lost colonies divided by max colonies 

colony <- colony %>% 
  mutate(`Percent Loss` = case_when(
    !is.na(`Percent Loss`) ~ `Percent Loss`,
    is.na(`Percent Loss`) ~ (round(`Lost Colonies`*100/`Maximum Colonies`))
  )
  )

colony[rowSums(is.na(colony)) > 0, ]

# Vermont missing data for renovated colonies 
# United States is also missing maximum colonies values; can we sum up all the states to fill in the missing values? 
```


```{r  Colony df: Confirming USA values are sum of all values & calculating max colony size for the US in each year/quarter}

not_us <- colony[!(colony$State == 'United States'), ]
unique(not_us$State)

not_us %>% 
  group_by(Year) %>% 
  summarise(total = sum(`Starting Colonies`))

colony %>% 
  filter(State == 'United States')

not_US_2015Q1 <- colony %>% 
  filter((Year == '2015-Q1') & (!State == 'United States'))

max_2015 <- not_US_2015Q1 %>%  
  summarise(sum(`Maximum Colonies`))
# 3619490

# max colonies for the US for each year/quarter; first output matches previous test case for 2015-Q1 
US_max_colonies <- colony %>% 
  select(State, `Maximum Colonies`, Year) %>% 
  filter(!State == "United States") %>% 
  group_by(Year) %>% 
  summarise("Max Colonies" = sum(`Maximum Colonies`))

US_colony <- colony %>% 
  select(everything()) %>% 
  filter(State == 'United States') %>% 
  mutate(`Maximum Colonies` = US_max_colonies$`Max Colonies`, .after =`Starting Colonies`)

US_colony

# removing US values from the original colony data set 

colony <- colony[!colony$State == 'United States',]

colony[rowSums(is.na(colony)) > 0, ]  # only Vermont showing NA values under renovated colonies and percent renovated 
```


```{r  Stressors df: Cleaning Stressors dataset; converting chr to numeric, separating United States values}
summary(stressors)

stressors <- stressors %>% 
  mutate_at(c(2:7), as.numeric)

stressors

sum(is.na(stressors))   # 597 missing values 

stressors[rowSums(is.na(stressors)) > 0, ]

stressors <- stressors[!stressors$State == 'United States', ]
stressors %>% 
  arrange(State)

# separating out US values into its own dataframe 
US_stressors <- stressors[stressors$State == 'United States', ]

US_stressors

```


```{r  Honey dataframe: checking missing values and separating US values}
summary(honey) 

sum(is.na(honey))  # no immediately apparent NA values 

unique(honey$State)

US_honey <- honey[honey$State == 'United States', ]

honey <- honey[!honey$State == 'United States', ]

```





